# Requirements Archive: v1.0 P2P Multiplayer

**Archived:** 2026-01-19
**Status:** ✅ SHIPPED

This is the archived requirements specification for v1.0.
For current requirements, see `.planning/PROJECT.md` (Active section).

---

## Core Value

Both players in a multiplayer game experience local-feeling responsiveness regardless of network latency, enabling valid research data collection without latency-induced behavioral artifacts.

---

## v1 Requirements

### WebRTC Transport Layer

| ID | Requirement | Acceptance Criteria | Status |
|----|-------------|---------------------|--------|
| WEBRTC-01 | WebRTC DataChannel connections | Clients establish DataChannel with `{ ordered: false, maxRetransmits: 0 }` for UDP-like behavior | ✅ Complete |
| WEBRTC-02 | SocketIO signaling for SDP/ICE | Server relays SDP offers/answers and ICE candidates; clients complete WebRTC handshake | ✅ Complete |
| WEBRTC-03 | TURN server fallback | When direct P2P fails (symmetric NAT), connection established via TURN relay within 5 seconds | ✅ Complete |
| WEBRTC-04 | Connection type detection | Log whether connection is direct P2P or TURN-relayed for research analytics | ✅ Complete |

### GGPO Enhancements

| ID | Requirement | Acceptance Criteria | Status |
|----|-------------|---------------------|--------|
| GGPO-01 | Symmetric peer architecture | No "host" client; both peers run identical simulation, neither has authority over the other | ✅ Complete |
| GGPO-02 | P2P input exchange over DataChannel | Inputs sent directly between peers (not via server) with frame number and checksum | ✅ Complete |
| GGPO-03 | Redundant input sending | Each packet includes last N inputs to handle packet loss without retransmission | ✅ Complete |
| GGPO-04 | Synchronous input processing | Inputs queued during network reception, processed synchronously at frame start before rollback | ✅ Complete |

### Player Support

| ID | Requirement | Acceptance Criteria | Status |
|----|-------------|---------------------|--------|
| NPLAY-01 | 2-player P2P support | Two human players connected via single WebRTC DataChannel with GGPO sync | ✅ Complete |

### Code Cleanup

| ID | Requirement | Acceptance Criteria | Status |
|----|-------------|---------------------|--------|
| CLEAN-01 | Remove legacy host-based sync | Remove "host client" election and state sync code; P2P mode uses symmetric peers only | ✅ Complete |

---

## Success Criteria

- [x] Two players can connect via WebRTC DataChannel (direct or TURN)
- [x] Both players experience identical, local-feeling input responsiveness
- [x] Rollback/replay occurs correctly on input misprediction
- [x] Game state remains synchronized (verified by hash comparison)
- [x] Legacy host-based sync code removed from P2P mode
- [x] Research experiments can run with valid data collection

---

## Technical Constraints

1. **Determinism**: Environments must remain fully deterministic (same seed + inputs = identical state)
2. **Browser compatibility**: WebRTC DataChannels must work in modern Chrome/Firefox/Safari
3. **Existing stack**: Must integrate with Flask/SocketIO/Pyodide — no major framework changes
4. **Parallel modes**: Server-authoritative mode preserved as separate option

---

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| WEBRTC-01 | Phase 1 | Complete |
| WEBRTC-02 | Phase 1 | Complete |
| WEBRTC-03 | Phase 4 | Complete |
| WEBRTC-04 | Phase 4 | Complete |
| GGPO-01 | Phase 3 | Complete |
| GGPO-02 | Phase 2 | Complete |
| GGPO-03 | Phase 2 | Complete |
| GGPO-04 | Phase 6 | Complete |
| NPLAY-01 | Phase 3 | Complete |
| CLEAN-01 | Phase 5 | Complete |

---

## Deferred to Future Milestones

| ID | Feature | Reason |
|----|---------|--------|
| GGPO-05 | Adaptive input delay | Complexity; fixed input delay sufficient for research |
| NPLAY-02 | N-player mesh topology | 2-player covers primary research use case |
| NPLAY-03 | Hybrid relay for large N | Requires NPLAY-02 first |
| MATCH-01 | Ping-based matchmaking | Nice-to-have, not critical for controlled experiments |

---

## Milestone Summary

**Shipped:** 10 of 10 v1 requirements
**Adjusted:** None
**Dropped:** None

---
*Archived: 2026-01-19 as part of v1.0 milestone completion*
