---
phase: 35-layout-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - interactive_gym/server/admin/templates/dashboard.html
  - interactive_gym/server/admin/static/admin.css
  - interactive_gym/server/admin/static/admin.js
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Active sessions panel is the primary focus in the main content area"
    - "Summary stats remain at the top, unchanged"
    - "Participants panel is in the sidebar as secondary reference"
    - "Problems indicator shows error/warning count at a glance"
    - "Information flows: summary stats > active sessions > supporting info"
  artifacts:
    - path: "interactive_gym/server/admin/templates/dashboard.html"
      provides: "Restructured layout with active sessions as primary panel"
      contains: "lg:col-span-8"
    - path: "interactive_gym/server/admin/static/admin.css"
      provides: "Updated styles for new layout"
      contains: ".problems-indicator"
    - path: "interactive_gym/server/admin/static/admin.js"
      provides: "Problems indicator logic"
      contains: "updateProblemsIndicator"
  key_links:
    - from: "dashboard.html"
      to: "admin.js"
      via: "problems-indicator element"
      pattern: "id=\"problems-indicator\""
    - from: "admin.js"
      to: "consoleLogs state"
      via: "error/warning count"
      pattern: "filter.*error.*warn"
---

<objective>
Restructure the admin dashboard layout to prioritize active sessions monitoring and surface problems prominently.

Purpose: Researchers need to monitor active sessions as their primary focus during experiments. The current layout buries active sessions in the sidebar while giving 8 columns to participants (which duplicates session info).

Output: Reorganized dashboard with active sessions as primary content, participants in sidebar, and problems indicator for quick error visibility.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@interactive_gym/server/admin/templates/dashboard.html
@interactive_gym/server/admin/static/admin.css
@interactive_gym/server/admin/static/admin.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restructure HTML layout</name>
  <files>interactive_gym/server/admin/templates/dashboard.html</files>
  <action>
Swap the main content grid structure:

1. **Main Content (8 columns) - now Active Sessions:**
   - Move the "Active Sessions (P2P Health)" card from sidebar to main content area
   - Give it 8 columns (`lg:col-span-8`)
   - Keep the health legend in the header
   - Update container ID to `session-list-panel` (keep `multiplayer-games-container` for JS compatibility)
   - Add larger empty state for the expanded panel

2. **Sidebar (4 columns) - now secondary info:**
   Reorder the sidebar cards in this priority:
   - Participants (condensed view, collapsible)
   - Waiting Rooms
   - Activity Timeline
   - Console Logs (keep filters)

3. **Add Problems Indicator to navbar:**
   After the connection status badge, add a problems indicator:
   ```html
   <div class="badge badge-lg gap-2 badge-error hidden" id="problems-indicator">
       <svg><!-- warning icon --></svg>
       <span class="problems-count">0</span>
       <span>Problems</span>
   </div>
   ```
   This shows only when there are errors/warnings in console logs.

4. **Participants panel in sidebar:**
   - Change from grid to compact list view
   - Show truncated ID + status badge only
   - Keep total count in header
   - Max-height with scroll
  </action>
  <verify>
Open dashboard.html in browser (or view source). Confirm:
- Active Sessions panel is in the 8-column area
- Sidebar has Participants, Waiting Rooms, Activity, Console Logs
- Problems indicator element exists in navbar
  </verify>
  <done>
Layout restructured with active sessions as primary focus. Problems indicator element present.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update CSS for new layout</name>
  <files>interactive_gym/server/admin/static/admin.css</files>
  <action>
Add/update styles for the new layout:

1. **Problems indicator styles:**
```css
.problems-indicator {
    cursor: pointer;
}
.problems-indicator:hover {
    opacity: 0.8;
}
```

2. **Expanded session list panel styles:**
```css
.session-list-expanded {
    min-height: 400px;
}

.session-list-expanded .empty-state {
    padding: 4rem 2rem;
}
```

3. **Compact participants list styles (for sidebar):**
```css
.participant-list-compact {
    max-height: 300px;
    overflow-y: auto;
}

.participant-item-compact {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.5rem 0.75rem;
    border-bottom: 1px solid oklch(var(--bc) / 0.08);
}

.participant-item-compact:last-child {
    border-bottom: none;
}

.participant-item-id {
    font-family: ui-monospace, monospace;
    font-size: 0.75rem;
    max-width: 100px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
```

4. **Session card updates for larger panel:**
- Keep existing `.session-card` styles
- Cards should expand to fill the wider space naturally
- Consider 2-column grid for session cards when many active:
```css
@media (min-width: 1024px) {
    .session-card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 0.75rem;
    }
}
```
  </action>
  <verify>
Check CSS parses without errors. Inspect styles in browser dev tools.
  </verify>
  <done>
CSS updated with problems indicator, expanded session list, and compact participant list styles.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update JavaScript for problems indicator and compact participants</name>
  <files>interactive_gym/server/admin/static/admin.js</files>
  <action>
1. **Add updateProblemsIndicator function:**
```javascript
function updateProblemsIndicator() {
    const indicator = document.getElementById('problems-indicator');
    if (!indicator) return;

    // Count errors and warnings
    const problemCount = consoleLogs.filter(l =>
        l.level === 'error' || l.level === 'warn'
    ).length;

    const countEl = indicator.querySelector('.problems-count');
    if (countEl) {
        countEl.textContent = problemCount;
    }

    // Show/hide based on count
    if (problemCount > 0) {
        indicator.classList.remove('hidden');
    } else {
        indicator.classList.add('hidden');
    }
}
```

2. **Call updateProblemsIndicator:**
- In `addConsoleLog()` after adding to consoleLogs
- In `updateDashboard()` after initializing console logs
- In filter change handlers (to update when filtering changes view)

3. **Add click handler for problems indicator:**
- Scroll to console logs section
- Set filter to errors+warnings
```javascript
document.addEventListener('DOMContentLoaded', () => {
    const indicator = document.getElementById('problems-indicator');
    if (indicator) {
        indicator.addEventListener('click', () => {
            const logsSection = document.getElementById('console-logs-container');
            if (logsSection) {
                logsSection.scrollIntoView({ behavior: 'smooth' });
            }
            // Could also auto-filter to errors
        });
    }
    // ... existing listeners
});
```

4. **Update updateParticipants for compact view:**
Replace the card-based grid with compact list:
```javascript
function updateParticipants(participants) {
    const container = document.getElementById('participants-container');
    if (!container) return;

    if (!participants || participants.length === 0) {
        container.innerHTML = `
            <div class="empty-state-sm">
                <p class="text-base-content/50 text-sm">No participants connected</p>
            </div>
        `;
        return;
    }

    // Sort: connected first
    const sorted = [...participants].sort((a, b) => {
        const statusPriority = { 'connected': 0, 'reconnecting': 1, 'disconnected': 2, 'completed': 3 };
        return (statusPriority[a.connection_status] ?? 4) - (statusPriority[b.connection_status] ?? 4);
    });

    container.innerHTML = `
        <div class="participant-list-compact">
            ${sorted.map(p => `
                <div class="participant-item-compact">
                    <span class="participant-item-id" title="${escapeHtml(p.subject_id)}">${escapeHtml(truncateId(p.subject_id))}</span>
                    ${getStatusBadge(p.connection_status)}
                </div>
            `).join('')}
        </div>
    `;
}
```

5. **Update session list container structure:**
Since the session list is now in the main area, update `updateSessionList` to use a grid wrapper:
```javascript
// In updateSessionList, wrap cards in grid container:
container.innerHTML = `<div class="session-card-grid">${sorted.map(game => renderSessionCard(game)).join('')}</div>`;
```
  </action>
  <verify>
```bash
# Verify JS syntax is valid
node --check interactive_gym/server/admin/static/admin.js
```
Then test in browser:
- Problems indicator appears when there are errors/warnings
- Problems indicator hidden when no problems
- Clicking problems indicator scrolls to console logs
- Participants show as compact list
- Session cards display in wider grid
  </verify>
  <done>
JavaScript updated with problems indicator logic and compact participant list rendering.
  </done>
</task>

</tasks>

<verification>
1. Start the server and navigate to admin dashboard
2. Verify layout:
   - Summary stat cards at top (unchanged)
   - Active Sessions panel takes 8 columns (primary focus)
   - Sidebar shows: Participants, Waiting Rooms, Activity, Console Logs
3. Verify problems indicator:
   - Hidden when no errors/warnings
   - Shows count when errors/warnings exist
   - Click scrolls to console logs
4. Verify participants:
   - Compact list view with ID + status badge
   - Scrollable when many participants
5. Visual hierarchy test:
   - Eye naturally flows: stats → active sessions → sidebar
   - Active sessions panel commands attention
</verification>

<success_criteria>
- LAYOUT-01: Clear visual hierarchy achieved (stats > sessions > details)
- LAYOUT-02: Information prioritized correctly (active sessions are primary during monitoring)
- Problems indicator provides at-a-glance error visibility
- No functionality lost from previous phases
</success_criteria>

<output>
After completion, create `.planning/phases/35-layout-polish/35-01-SUMMARY.md`
</output>
