---
phase: 97-python-surface-core
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - mug/rendering/__init__.py
  - mug/rendering/types.py
  - mug/rendering/color.py
autonomous: true
requirements:
  - COLOR-01
  - COLOR-02
  - COLOR-03
  - COLOR-04

must_haves:
  truths:
    - "normalize_color((255, 0, 0)) returns '#ff0000'"
    - "normalize_color('#FF0000') returns '#ff0000'"
    - "normalize_color('red') returns '#ff0000'"
    - "normalize_color('invalid') raises ValueError"
    - "DrawCommand dataclass stores object_type, id, params, persistent as immutable record"
    - "RenderPacket dataclass stores objects list and removed list, with to_dict() serialization"
  artifacts:
    - path: "mug/rendering/__init__.py"
      provides: "Public exports for rendering subpackage"
      contains: "Surface, RenderPacket"
    - path: "mug/rendering/types.py"
      provides: "DrawCommand and RenderPacket dataclasses"
      exports: ["DrawCommand", "RenderPacket"]
    - path: "mug/rendering/color.py"
      provides: "Color normalization and named color lookup"
      exports: ["normalize_color", "NAMED_COLORS"]
  key_links:
    - from: "mug/rendering/__init__.py"
      to: "mug/rendering/types.py"
      via: "re-export of RenderPacket"
      pattern: "from .types import"
    - from: "mug/rendering/__init__.py"
      to: "mug/rendering/color.py"
      via: "color module available in package"
      pattern: "from .color import"
---

<objective>
Create the rendering subpackage foundation: type definitions (DrawCommand, RenderPacket) and color normalization utility.

Purpose: Establish the data structures and color handling that the Surface class (Plan 02) depends on. These are leaf modules with no intra-project dependencies, enabling parallel development of tests.
Output: `mug/rendering/` package with `types.py`, `color.py`, and `__init__.py`
</objective>

<execution_context>
@/Users/chasemcd/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chasemcd/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/97-python-surface-core/97-RESEARCH.md
@mug/configurations/object_contexts.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create rendering package with types.py and color.py</name>
  <files>
    mug/rendering/__init__.py
    mug/rendering/types.py
    mug/rendering/color.py
  </files>
  <action>
Create the `mug/rendering/` directory and three files:

**mug/rendering/types.py:**
- `DrawCommand` frozen dataclass with fields:
  - `object_type: str` (e.g., "rect", "circle", "line", "polygon", "text", "sprite", "arc", "ellipse")
  - `id: str` (user-provided or auto-generated UUID)
  - `params: dict` (all draw parameters, already normalized — color as hex, coordinates as-is)
  - `persistent: bool = False`
- `RenderPacket` dataclass with fields:
  - `objects: list[dict]` (list of wire-format object dicts ready for JSON serialization)
  - `removed: list[str]` (list of removed persistent object IDs)
  - `to_dict() -> dict` method returning `{"game_state_objects": self.objects, "removed": self.removed}` — the key `game_state_objects` matches the existing JS renderer's expected format for backward compatibility

**mug/rendering/color.py:**
- `NAMED_COLORS` dict with ~20 common CSS named colors mapped to `#rrggbb` hex strings: red, green, blue, white, black, yellow, cyan, magenta, orange, purple, pink, brown, gray, grey, lime, navy, teal, maroon, olive, aqua
- `normalize_color(color) -> str` function that:
  - Accepts `tuple[int, int, int]` RGB tuples: validates 3 ints 0-255, returns `#rrggbb`
  - Accepts hex strings `#rrggbb` or `#rgb` (shorthand expanded): validates format, returns lowercase `#rrggbb`
  - Accepts named strings: looks up in NAMED_COLORS, returns `#rrggbb`
  - Raises `ValueError` for unrecognized strings
  - Raises `TypeError` for non-tuple, non-string input
  - Uses `re` module for hex validation pattern `^#[0-9a-f]{6}$` and `^#[0-9a-f]{3}$`

**mug/rendering/__init__.py:**
- Import and re-export: `RenderPacket` from `.types`, `normalize_color` and `NAMED_COLORS` from `.color`
- Also import `Surface` from `.surface` but wrap in a lazy import or comment placeholder (Surface doesn't exist yet — use `# from .surface import Surface` as a TODO comment that Plan 02 will uncomment)
- Add module docstring: "PyGame-inspired imperative rendering API for MUG environments."

Use `from __future__ import annotations` at the top of all files. Use Python 3.10+ type hints (str | None, etc.).
  </action>
  <verify>
Run `python -c "from mug.rendering.types import DrawCommand, RenderPacket; from mug.rendering.color import normalize_color, NAMED_COLORS; print('imports OK')"` — must print "imports OK".

Run `python -c "from mug.rendering.color import normalize_color; assert normalize_color((255,0,0)) == '#ff0000'; assert normalize_color('#FF0000') == '#ff0000'; assert normalize_color('red') == '#ff0000'; print('color OK')"` — must print "color OK".

Run `python -c "from mug.rendering.types import RenderPacket; rp = RenderPacket(objects=[{'uuid':'a'}], removed=['b']); d = rp.to_dict(); assert d['game_state_objects'] == [{'uuid':'a'}]; assert d['removed'] == ['b']; print('types OK')"` — must print "types OK".
  </verify>
  <done>
- `mug/rendering/` package exists with `__init__.py`, `types.py`, `color.py`
- `DrawCommand` is a frozen dataclass with object_type, id, params, persistent fields
- `RenderPacket` has objects/removed fields and `to_dict()` returning `game_state_objects` key
- `normalize_color()` handles RGB tuples, hex strings (#rrggbb and #rgb shorthand), and ~20 named colors
- `normalize_color()` raises ValueError/TypeError on bad input
- All verify commands pass
  </done>
</task>

</tasks>

<verification>
1. `python -c "from mug.rendering.types import DrawCommand, RenderPacket"` succeeds
2. `python -c "from mug.rendering.color import normalize_color; normalize_color((255,0,0))"` returns `'#ff0000'`
3. `python -c "from mug.rendering.color import normalize_color; normalize_color('red')"` returns `'#ff0000'`
4. `python -c "from mug.rendering.color import normalize_color; normalize_color('#abc')"` returns `'#aabbcc'`
5. No import errors from `mug.rendering`
</verification>

<success_criteria>
- All three files exist under `mug/rendering/`
- Color normalization handles all three input formats (tuple, hex, named) correctly
- Type definitions are importable and serializable
- No new external dependencies introduced
</success_criteria>

<output>
After completion, create `.planning/phases/97-python-surface-core/97-01-SUMMARY.md`
</output>
