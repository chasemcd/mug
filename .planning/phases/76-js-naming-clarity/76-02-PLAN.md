---
phase: 76-js-naming-clarity
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - interactive_gym/server/static/js/index.js
autonomous: true

must_haves:
  truths:
    - "All socket event handler callback parameters in index.js use context-specific names instead of generic data"
    - "The updateWaitroomText function parameter is renamed from data to waitroomConfig"
    - "No JavaScript runtime errors introduced by renames"
  artifacts:
    - path: "interactive_gym/server/static/js/index.js"
      provides: "Main client JS with descriptive socket handler parameters"
  key_links:
    - from: "interactive_gym/server/static/js/index.js"
      to: "server socket events"
      via: "socket.on callbacks"
      pattern: "socket\\.on\\("
---

<objective>
Rename generic `data` parameters in socket event handlers in index.js to context-specific names that communicate what kind of data each handler receives.

Purpose: index.js has ~26 socket event handlers that all use the same generic parameter name `data`, making it hard to understand what each handler receives without reading the body. Context-specific names (e.g., `experimentConfig`, `sceneData`, `waitroomState`) make the handlers self-documenting.

Output: index.js with descriptive callback parameter names throughout.
</objective>

<execution_context>
@/Users/chasemcd/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chasemcd/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/76-js-naming-clarity/76-RESEARCH.md
@interactive_gym/server/static/js/index.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename socket handler parameters in index.js (first half)</name>
  <files>interactive_gym/server/static/js/index.js</files>
  <action>
Rename the `data` callback parameter to a context-specific name in the following socket event handlers in index.js. For each handler, replace all occurrences of `data` within that handler's scope (the callback function body) with the new name.

**IMPORTANT:** These are all LOCAL parameter renames -- the parameter name only exists within the handler's callback function. This means each rename is scoped to a single function body and cannot affect other handlers. Work through each handler one at a time.

**Renames for first half of file (lines 1-980):**

1. `socket.on('pong', function(data)` (line 367) -> `function(latencyData)`
   - Body uses: `data.max_latency` -> `latencyData.max_latency`

2. `socket.on('server_session_id', function(data)` (line 636) -> `function(sessionInfo)`
   - Body uses: `data.session_id` -> `sessionInfo.session_id`

3. `socket.on('join_game_error', function(data)` (line 641) -> `function(errorInfo)`
   - Body uses: `data.message` -> `errorInfo.message`

4. `socket.on('experiment_config', async function(data)` (line 651) -> `async function(experimentConfig)`
   - Body uses: `data.entry_screening`, `data.pyodide_config`, `data.pyodide_config.needs_pyodide`, `data.pyodide_config.pyodide_load_timeout_s` -> all `experimentConfig.*`

5. `socket.on('session_restored', function(data)` (line 775) -> `function(restoredSession)`
   - Body uses: `data.interactiveGymGlobals` -> `restoredSession.interactiveGymGlobals`

6. `socket.on('duplicate_session', function(data)` (line 807) -> `function(duplicateInfo)`
   - Body uses: `data.message` -> `duplicateInfo.message`

7. `socket.on('invalid_session', function(data)` (line 830) -> `function(invalidInfo)`
   - Body uses: `data.message` -> `invalidInfo.message`

8. `socket.on('start_game', function(data)` (line 840) -> `function(gameStartData)`
   - Body uses: `data.scene_metadata`, `data.game_id` -> `gameStartData.*`

9. `socket.on('match_found_countdown', function(data)` (line 903) -> `function(countdownInfo)`
   - Body uses: `data.countdown_seconds`, `data.message` -> `countdownInfo.*`

10. `socket.on("waiting_room", function(data)` (line 930) -> `function(waitroomState)`
    - Body uses: `data.cur_num_players`, `data.players_needed`, `data.ms_remaining`, `data.waitroom_timeout_message`, `data.hide_lobby_count` -> `waitroomState.*`
    - NOTE: This handler calls `updateWaitroomText(data, timer)` -- update this call to `updateWaitroomText(waitroomState, timer)`

11. `socket.on("single_player_waiting_room", function(data)` (line 983) -> `function(singlePlayerWaitroom)`
    - Body uses: `data.ms_remaining`, `data.wait_duration_s` -> `singlePlayerWaitroom.*`
    - Also calls `updateWaitroomText(data, simulater_timer)` -> `updateWaitroomText(singlePlayerWaitroom, simulater_timer)`

12. `socket.on("single_player_waiting_room_failure", function(data)` (line 1023) -> `function(failureInfo)`
    - Body: This handler does NOT actually use `data` in its body (it only uses `waitroomTimeoutMessage`). Simply rename the parameter.

Be very careful with handler #4 (`experiment_config`) as it has the most complex body -- there are many references to `data.` properties. Count all `data.` occurrences in that handler before and after to ensure completeness.
  </action>
  <verify>
1. Count `function(data)` in the first 1000 lines of index.js -- should be 0 (all handlers in this range renamed)
2. The new parameter names appear in the correct handlers
3. No stale `data.` references remain within renamed handler bodies (search within each handler scope)
4. `python -m pytest tests/unit/ -v` passes
  </verify>
  <done>The first 12 socket handlers in index.js use context-specific parameter names instead of generic `data`.</done>
</task>

<task type="auto">
  <name>Task 2: Rename socket handler parameters in index.js (second half) and updateWaitroomText</name>
  <files>interactive_gym/server/static/js/index.js</files>
  <action>
Continue renaming `data` callback parameters in the remaining socket event handlers (lines 1000+), and rename the `data` parameter in the standalone `updateWaitroomText` function.

**Renames for second half of file (lines 1000+):**

1. `socket.on('p2p_validation_status', function(data)` (line 1070) -> `function(validationStatus)`
   - Body uses: `data.status` -> `validationStatus.status`

2. `socket.on('p2p_validation_repool', function(data)` (line 1075) -> `function(repoolInfo)`
   - Body uses: `data.reason`, `data.message` -> `repoolInfo.*`

3. `socket.on('p2p_validation_complete', function(data)` (line 1097) -> `function(validationResult)`
   - Body: does not use `data` in body. Simply rename parameter.

4. `socket.on("game_reset", function(data)` (line 1118) -> `function(resetData)`
   - Body uses: `data.scene_metadata`, `data.config`, `data.timeout`, `data.room` -> `resetData.*`

5. `socket.on("create_game_failed", function(data)` (line 1194) -> `function(failureData)`
   - Body uses: `data['error']` -> `failureData['error']`

6. `socket.on('environment_state', function(data)` (line 1210) -> `function(stateUpdate)`
   - Body uses: `data.hud_text`, and passes `data` to `addStateToBuffer(data)` -> `stateUpdate.*`, `addStateToBuffer(stateUpdate)`

7. `socket.on('end_game', function(data)` (line 1220) -> `function(endGameInfo)`
   - Body uses: `data.message` -> `endGameInfo.message`

8. `socket.on('end_game_request_redirect', function(data)` (line 1240) -> `function(redirectInfo)`
   - Body uses: `data.redirect_url`, `data.redirect_timeout` -> `redirectInfo.*`

9. `socket.on('update_game_page_text', function(data)` (line 1249) -> `function(pageUpdate)`
   - Body uses: `data.game_page_text` -> `pageUpdate.game_page_text`

10. `socket.on('request_pressed_keys', function(data)` (line 1258) -> `function(keyRequest)`
    - Body: does not use `data` in body. Simply rename parameter.

11. `socket.on("activate_scene", function(data)` (line 1271) -> `function(sceneData)`
    - Body uses: `data.scene_id`, `data.globals` -> `sceneData.*`

12. `socket.on("terminate_scene", function(data)` (line 1285) -> `function(terminationData)`
    - Body uses: `data.element_ids`, `data.scene_id` -> `terminationData.*`

13. `socket.on("update_unity_score", function(data)` (line 1763) -> `function(scoreUpdate)`
    - Body uses: `data.score`, `data.num_episodes` -> `scoreUpdate.*`

14. `socket.on("unity_episode_end", function(data)` (line 1782) -> `function(episodeEndData)`
    - Body uses: `data.num_episodes`, `data.all_episodes_done` -> `episodeEndData.*`

**Also rename the standalone function parameter:**

15. `function updateWaitroomText(data, timer)` (line 1102) -> `function updateWaitroomText(waitroomConfig, timer)`
    - Body uses: `data.hide_lobby_count`, `data.cur_num_players`, `data.players_needed` -> `waitroomConfig.*`

**ProbeManager internal handlers** (lines 33, 69):
These use `data` with immediate destructuring, which is already clear. Leave them as-is since destructuring provides context.

Verify each rename by checking that no stale `data.` references remain within the renamed handler's scope.
  </action>
  <verify>
1. `grep -c 'function(data)' interactive_gym/server/static/js/index.js` returns 0 (all handlers renamed)
2. `grep 'function(data)' interactive_gym/server/static/js/index.js` returns no matches (double-check)
3. The `updateWaitroomText` function parameter is `waitroomConfig`, not `data`
4. All call sites of `updateWaitroomText` pass the correctly-renamed variable (not stale `data`)
5. `python -m pytest tests/unit/ -v` passes
  </verify>
  <done>All remaining socket handlers and the standalone `updateWaitroomText` function use context-specific parameter names. Zero occurrences of `function(data)` remain in the file (excluding ProbeManager destructuring handlers which are already clear).</done>
</task>

</tasks>

<verification>
1. `grep -c 'function(data)' interactive_gym/server/static/js/index.js` returns 0
2. `grep 'updateWaitroomText(data' interactive_gym/server/static/js/index.js` returns 0
3. No stale `data.` references within renamed handler scopes
4. ProbeManager handlers (which destructure immediately) are left alone
5. `python -m pytest tests/unit/ -v` passes
6. No JavaScript syntax errors in index.js
</verification>

<success_criteria>
- All ~26 socket event handler callbacks in index.js use context-specific parameter names
- The `updateWaitroomText` function parameter is renamed from `data` to `waitroomConfig`
- All call sites of `updateWaitroomText` pass the correctly-renamed variable
- Python tests pass
- No JavaScript syntax errors
</success_criteria>

<output>
After completion, create `.planning/phases/76-js-naming-clarity/76-02-SUMMARY.md`
</output>
