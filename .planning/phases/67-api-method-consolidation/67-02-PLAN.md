---
phase: 67-api-method-consolidation
plan: 02
type: execute
wave: 2
depends_on: ["67-01"]
files_modified:
  - interactive_gym/scenes/gym_scene.py
autonomous: true

must_haves:
  truths:
    - "GymScene has a content() method that accepts scene_header, scene_body, scene_body_filepath, in_game_scene_body, in_game_scene_body_filepath, game_page_html_fn"
    - "GymScene has a waitroom() method that accepts timeout, timeout_redirect_url, timeout_scene_id, timeout_message"
    - "GymScene has an assets() method that accepts preload_specs, assets_dir, assets_to_preload, animation_configs, state_init"
    - "The existing rendering() method no longer accepts asset params (preload_specs, assets_dir, assets_to_preload, animation_configs, state_init) but STILL accepts display params (fps, env_to_state_fn, hud_text_fn, hud_score_carry_over, location_representation, game_width, game_height, background, rollback_smoothing_duration)"
    - "in_game_scene_body is initialized in __init__ as None"
    - "All old methods (user_experience, rendering with all 14 params) still exist and work unchanged"
    - "All four new/updated methods return self for method chaining"
  artifacts:
    - path: "interactive_gym/scenes/gym_scene.py"
      provides: "content(), waitroom(), assets() builder methods"
      contains: "def content"
    - path: "interactive_gym/scenes/gym_scene.py"
      provides: "waitroom() builder method"
      contains: "def waitroom"
    - path: "interactive_gym/scenes/gym_scene.py"
      provides: "assets() builder method"
      contains: "def assets"
  key_links:
    - from: "waitroom() param 'timeout'"
      to: "self.waitroom_timeout"
      via: "conditional assignment (shortened param name)"
      pattern: "self\\.waitroom_timeout = timeout"
    - from: "content() param 'in_game_scene_body'"
      to: "self.in_game_scene_body"
      via: "conditional assignment"
      pattern: "self\\.in_game_scene_body = in_game_scene_body"
    - from: "content() param 'scene_body_filepath'"
      to: "self.scene_body"
      via: "file read then assignment"
      pattern: "self\\.scene_body = f\\.read"
---

<objective>
Add `content()`, `waitroom()`, and `assets()` builder methods to GymScene; update `rendering()` to exclude asset params.

Purpose: APIC-04 (split user_experience into content + waitroom), APIC-05 (split rendering into rendering + assets). Also fixes Pitfall 1 (add `in_game_scene_body` to `__init__`).

Output: `gym_scene.py` with three new builder methods and an updated `rendering()` method signature, all co-existing with old methods.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/67-api-method-consolidation/67-RESEARCH.md
@.planning/phases/67-api-method-consolidation/67-01-SUMMARY.md

# Primary source file (will have runtime() and multiplayer() from Plan 01)
@interactive_gym/scenes/gym_scene.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add content() and waitroom() methods, fix __init__</name>
  <files>interactive_gym/scenes/gym_scene.py</files>
  <action>
THREE changes to make:

**Change 1: Fix Pitfall 1 in __init__**

In `GymScene.__init__()`, in the `# user_experience` section (around line 113-121), add this line after `self.scene_body: str = None`:

```python
self.in_game_scene_body: str = None
```

This attribute is currently set dynamically by `user_experience()` but never initialized. Adding it prevents AttributeError when accessing `scene.in_game_scene_body` on scenes that never called `content()` or `user_experience()`.

**Change 2: Add content() method**

Place it AFTER the `user_experience()` method. The method splits out the content-related params from `user_experience()`:

```python
def content(
    self,
    scene_header: str = NotProvided,
    scene_body: str = NotProvided,
    scene_body_filepath: str = NotProvided,
    in_game_scene_body: str = NotProvided,
    in_game_scene_body_filepath: str = NotProvided,
    game_page_html_fn: Callable = NotProvided,
):
    """Configure scene content display.

    :param scene_header: Header text for the scene, defaults to NotProvided
    :type scene_header: str, optional
    :param scene_body: HTML body content for the scene, defaults to NotProvided
    :type scene_body: str, optional
    :param scene_body_filepath: Path to a file containing HTML body content, defaults to NotProvided
    :type scene_body_filepath: str, optional
    :param in_game_scene_body: HTML body content displayed during gameplay, defaults to NotProvided
    :type in_game_scene_body: str, optional
    :param in_game_scene_body_filepath: Path to a file containing in-game HTML body, defaults to NotProvided
    :type in_game_scene_body_filepath: str, optional
    :param game_page_html_fn: Function to generate custom game page HTML, defaults to NotProvided
    :type game_page_html_fn: Callable, optional
    :return: This scene object
    :rtype: GymScene
    """
```

Copy EXACT logic from `user_experience()` for these 6 params:
- `scene_header`: set `self.scene_header`
- `scene_body` / `scene_body_filepath`: mutual exclusion assert, file read logic, set `self.scene_body`
- `in_game_scene_body` / `in_game_scene_body_filepath`: mutual exclusion assert, file read logic, set `self.in_game_scene_body`
- `game_page_html_fn`: set `self.game_page_html_fn`

Return `self`.

**Change 3: Add waitroom() method**

Place it AFTER `content()`. The method splits out the waitroom-related params from `user_experience()`:

```python
def waitroom(
    self,
    timeout: int = NotProvided,
    timeout_redirect_url: str = NotProvided,
    timeout_scene_id: str = NotProvided,
    timeout_message: str = NotProvided,
):
    """Configure waitroom behavior.

    :param timeout: Timeout for waitroom in milliseconds, defaults to NotProvided
    :type timeout: int, optional
    :param timeout_redirect_url: URL to redirect to if waitroom times out, defaults to NotProvided
    :type timeout_redirect_url: str, optional
    :param timeout_scene_id: Scene ID to jump to if waitroom times out, defaults to NotProvided
    :type timeout_scene_id: str, optional
    :param timeout_message: Custom message when waitroom times out, defaults to NotProvided
    :type timeout_message: str, optional
    :return: This scene object
    :rtype: GymScene
    """
```

CRITICAL: The parameter names are SHORTENED (no `waitroom_` prefix) but the instance attributes retain the full prefix:
- `timeout` param -> `self.waitroom_timeout`
- `timeout_redirect_url` param -> `self.waitroom_timeout_redirect_url`
- `timeout_scene_id` param -> `self.waitroom_timeout_scene_id`
- `timeout_message` param -> `self.waitroom_timeout_message`

Return `self`.

Do NOT modify the existing `user_experience()` method. It must continue to work unchanged.
  </action>
  <verify>
1. Verify __init__ fix: `python -c "from interactive_gym.scenes.gym_scene import GymScene; s = GymScene(); assert hasattr(s, 'in_game_scene_body'); assert s.in_game_scene_body is None; print('__init__ fix OK')"`

2. Verify content(): `python -c "from interactive_gym.scenes.gym_scene import GymScene; s = GymScene(); s.content(scene_header='Test', scene_body='<p>Hi</p>', in_game_scene_body='<p>Game</p>'); assert s.scene_header == 'Test'; assert s.scene_body == '<p>Hi</p>'; assert s.in_game_scene_body == '<p>Game</p>'; print('content() OK')"`

3. Verify waitroom(): `python -c "from interactive_gym.scenes.gym_scene import GymScene; s = GymScene(); s.waitroom(timeout=60000, timeout_message='Please wait'); assert s.waitroom_timeout == 60000; assert s.waitroom_timeout_message == 'Please wait'; print('waitroom() OK')"`

4. Verify chaining: `python -c "from interactive_gym.scenes.gym_scene import GymScene; s = GymScene(); result = s.content(scene_header='X').waitroom(timeout=5000); assert result is s; assert s.scene_header == 'X'; assert s.waitroom_timeout == 5000; print('chaining OK')"`

5. Verify old method still works: `python -c "from interactive_gym.scenes.gym_scene import GymScene; s = GymScene(); s.user_experience(scene_header='Old', waitroom_timeout=30000); assert s.scene_header == 'Old'; assert s.waitroom_timeout == 30000; print('old user_experience() still works')"`
  </verify>
  <done>
- `self.in_game_scene_body: str = None` exists in `__init__`
- `content()` method exists with 6 content params
- `waitroom()` method exists with 4 shortened param names mapping to full attribute names
- All file-read and mutual-exclusion logic preserved from `user_experience()`
- Both methods return self for chaining
- Old `user_experience()` untouched and still works
  </done>
</task>

<task type="auto">
  <name>Task 2: Add assets() method and create slimmed rendering()</name>
  <files>interactive_gym/scenes/gym_scene.py</files>
  <action>
TWO changes to make:

**Change 1: Add assets() method**

Place it AFTER the existing `rendering()` method. This method takes the 5 asset-related params that are being split out of `rendering()`:

```python
def assets(
    self,
    preload_specs: list[dict[str, str | float | int]] = NotProvided,
    assets_dir: str = NotProvided,
    assets_to_preload: list[str] = NotProvided,
    animation_configs: list = NotProvided,
    state_init: list = NotProvided,
):
    """Configure asset loading and initialization.

    :param preload_specs: Specifications for preloading assets, defaults to NotProvided
    :type preload_specs: list[dict[str, str | float | int]], optional
    :param assets_dir: Directory containing game assets, defaults to NotProvided
    :type assets_dir: str, optional
    :param assets_to_preload: List of asset filenames to preload, defaults to NotProvided
    :type assets_to_preload: list[str], optional
    :param animation_configs: Configurations for game animations, defaults to NotProvided
    :type animation_configs: list, optional
    :param state_init: Initial state of the game, defaults to NotProvided
    :type state_init: list, optional
    :return: This scene object
    :rtype: GymScene
    """
    if preload_specs is not NotProvided:
        self.preload_specs = preload_specs

    if assets_dir is not NotProvided:
        self.assets_dir = assets_dir

    if assets_to_preload is not NotProvided:
        self.assets_to_preload = assets_to_preload

    if animation_configs is not NotProvided:
        self.animation_configs = animation_configs

    if state_init is not NotProvided:
        self.state_init = state_init

    return self
```

All params map directly to `self.<same_name>`. No special validation needed (the original `rendering()` method had no validation on these params).

**Change 2: DO NOT modify the existing rendering() method**

IMPORTANT: The existing `rendering()` method must keep ALL 14 parameters for backwards compatibility. Phase 68 will remove the asset params from it. In Phase 67, we only ADD new methods -- we do not modify existing method signatures.

The `assets()` method is an ADDITIONAL way to set the same attributes, not a replacement yet.

Return `self`.
  </action>
  <verify>
1. Verify assets(): `python -c "from interactive_gym.scenes.gym_scene import GymScene; s = GymScene(); s.assets(assets_dir='/my/assets/', assets_to_preload=['sprite.png'], state_init=[{'x': 0}]); assert s.assets_dir == '/my/assets/'; assert s.assets_to_preload == ['sprite.png']; assert s.state_init == [{'x': 0}]; print('assets() OK')"`

2. Verify chaining: `python -c "from interactive_gym.scenes.gym_scene import GymScene; s = GymScene(); result = s.rendering(fps=30, game_width=800).assets(assets_dir='/assets/'); assert result is s; assert s.fps == 30; assert s.assets_dir == '/assets/'; print('rendering->assets chaining OK')"`

3. Verify existing rendering() unchanged: `python -c "from interactive_gym.scenes.gym_scene import GymScene; s = GymScene(); s.rendering(fps=30, preload_specs=[{'url': 'x'}], assets_dir='/old/'); assert s.fps == 30; assert s.preload_specs == [{'url': 'x'}]; assert s.assets_dir == '/old/'; print('old rendering() still works with all 14 params')"`

4. Full chaining across all new methods: `python -c "
from interactive_gym.scenes.gym_scene import GymScene
s = (GymScene()
    .runtime(run_through_pyodide=True)
    .multiplayer(multiplayer=True)
    .content(scene_header='Test')
    .waitroom(timeout=60000)
    .rendering(fps=30, game_width=800)
    .assets(assets_dir='/assets/')
    .gameplay(num_episodes=3)
    .policies()
)
assert s.run_through_pyodide == True
assert s.pyodide_multiplayer == True
assert s.scene_header == 'Test'
assert s.waitroom_timeout == 60000
assert s.fps == 30
assert s.assets_dir == '/assets/'
assert s.num_episodes == 3
print('full chain OK')
"`

5. Run full test suite: `cd /Users/chasemcd/Repositories/interactive-gym && python -m pytest tests/ -x -q 2>&1 | tail -5`
  </verify>
  <done>
- `assets()` method exists with 5 asset params
- Existing `rendering()` method is UNCHANGED (still accepts all 14 params)
- `assets()` returns self for chaining
- All new methods (runtime, multiplayer, content, waitroom, assets) chain correctly with each other and existing methods
- All existing tests pass
  </done>
</task>

</tasks>

<verification>
After both tasks, run comprehensive verification:

1. Verify all 5 new methods exist:
   `python -c "from interactive_gym.scenes.gym_scene import GymScene; s = GymScene(); methods = ['runtime', 'multiplayer', 'content', 'waitroom', 'assets']; assert all(hasattr(s, m) and callable(getattr(s, m)) for m in methods); print('all 5 new methods exist')"`

2. Verify all old methods still exist:
   `python -c "from interactive_gym.scenes.gym_scene import GymScene; s = GymScene(); old = ['pyodide', 'matchmaking', 'player_grouping', 'continuous_monitoring', 'exclusion_callbacks', 'reconnection_config', 'partner_disconnect_message_config', 'focus_loss_config', 'user_experience', 'rendering', 'policies', 'gameplay', 'environment', 'player_pairing']; assert all(hasattr(s, m) and callable(getattr(s, m)) for m in old); print('all old methods preserved')"`

3. Verify APIC-06 (policies and gameplay unchanged):
   `python -c "from interactive_gym.scenes.gym_scene import GymScene; s = GymScene(); s.policies(frame_skip=2).gameplay(num_episodes=5, max_steps=100); assert s.frame_skip == 2; assert s.num_episodes == 5; print('APIC-06 OK')"`

4. Run full test suite: `cd /Users/chasemcd/Repositories/interactive-gym && python -m pytest tests/ -x -q`
</verification>

<success_criteria>
- APIC-04: `content()` exists with 6 content params; `waitroom()` exists with 4 shortened params
- APIC-05: `assets()` exists with 5 asset params; `rendering()` still works with all 14 params (not slimmed yet -- Phase 68)
- Pitfall 1 fixed: `in_game_scene_body` initialized in `__init__`
- All old methods still work unchanged
- All new methods return self for chaining
- All existing tests pass with zero changes
</success_criteria>

<output>
After completion, create `.planning/phases/67-api-method-consolidation/67-02-SUMMARY.md`
</output>
